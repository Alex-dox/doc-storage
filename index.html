<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>DocStorage</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: #181A1B;
      color: #F3F6F8;
      margin: 0;
      display: flex;
      height: 100vh;
    }
    aside {
      width: 240px;
      background: #202225;
      display: flex;
      flex-direction: column;
      padding: 32px 20px;
      border-right: 1px solid #2a2d2f;
      gap: 24px;
    }
    .menu-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    .menu-logo {
      font-weight: 600;
      font-size: 20px;
      color: #72E4A0;
    }
    .add-icon-btn {
      width: 32px;
      height: 32px;
      background: #72E4A0;
      color: #181A1B;
      border: none;
      border-radius: 6px;
      font-size: 20px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      line-height: 1;
    }
    .add-icon-btn:hover {
      background: #4BC483;
      transform: scale(1.05);
    }
    .menu-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .menu-title {
      font-size: 12px;
      text-transform: uppercase;
      color: #74cba4;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .menu-item {
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 14px;
      color: #B6BABF;
    }
    .menu-item:hover {
      background: #2a2d2f;
      color: #F3F6F8;
    }
    .menu-item.active {
      background: rgba(114, 228, 160, 0.15);
      color: #72E4A0;
    }
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 40px 48px;
      overflow-y: auto;
    }
    .main-header {
      margin-bottom: 32px;
    }
    .main-title {
      font-size: 28px;
      font-weight: 600;
      margin: 0 0 8px 0;
    }
    .main-subtitle {
      font-size: 15px;
      color: #B6BABF;
    }
    .preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }
    .preview-card {
      background: #212324;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }
    .preview-card:hover {
      border-color: #72E4A0;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(114, 228, 160, 0.15);
    }
    .preview-icon {
      width: 48px;
      height: 48px;
      background: #2a2d2f;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 16px;
    }
    .preview-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #F3F6F8;
      line-height: 1.3;
    }
    .preview-desc {
      font-size: 13px;
      color: #B6BABF;
      line-height: 1.5;
      margin-bottom: 12px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .preview-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .preview-tag {
      background: rgba(114, 228, 160, 0.15);
      color: #72E4A0;
      font-size: 11px;
      border-radius: 6px;
      padding: 3px 8px;
    }
    .upload-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(24, 26, 27, 0.85);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 40px;
      overflow-y: auto;
    }
    .upload-modal.active {
      display: flex;
    }
    .upload-form {
      background: #212324;
      border-radius: 16px;
      max-width: 600px;
      width: 100%;
      padding: 32px 28px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .upload-form h2 {
      margin: 0 0 24px 0;
      font-size: 22px;
      color: #F3F6F8;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #74cba4;
      font-size: 14px;
      font-weight: 500;
    }
    .form-group input[type="text"],
    .form-group textarea {
      width: 100%;
      background: #2a2d2f;
      border: 1px solid #3a3d3f;
      border-radius: 8px;
      padding: 10px 12px;
      color: #F3F6F8;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
    }
    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    .file-input-wrapper {
      position: relative;
      background: #2a2d2f;
      border: 2px dashed #72E4A0;
      border-radius: 8px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .file-input-wrapper:hover {
      background: #323537;
      border-color: #4BC483;
    }
    .file-input-wrapper input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      cursor: pointer;
    }
    .file-input-label {
      color: #B6BABF;
      font-size: 14px;
    }
    .selected-file {
      margin-top: 12px;
      color: #72E4A0;
      font-size: 13px;
    }
    .tag-input-wrapper {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 8px;
      background: #2a2d2f;
      border: 1px solid #3a3d3f;
      border-radius: 8px;
      min-height: 42px;
      align-items: center;
    }
    .tag-item {
      background: rgba(114, 228, 160, 0.15);
      color: #72E4A0;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .tag-remove {
      cursor: pointer;
      font-weight: bold;
      opacity: 0.7;
      font-size: 16px;
    }
    .tag-remove:hover {
      opacity: 1;
    }
    .tag-input {
      flex: 1;
      min-width: 120px;
      background: transparent;
      border: none;
      color: #F3F6F8;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      outline: none;
      padding: 4px;
    }
    .help-text {
      font-size: 12px;
      color: #6a6d6f;
      margin-top: 4px;
    }
    .form-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    .btn {
      flex: 1;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Inter', sans-serif;
    }
    .btn-primary {
      background: #72E4A0;
      color: #181A1B;
    }
    .btn-primary:hover {
      background: #4BC483;
    }
    .btn-primary:disabled {
      background: #3a3d3f;
      color: #6a6d6f;
      cursor: not-allowed;
    }
    .btn-secondary {
      background: transparent;
      color: #B6BABF;
      border: 1px solid #3a3d3f;
    }
    .btn-secondary:hover {
      background: #2a2d2f;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(24, 26, 27, 0.85);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 40px;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal-card {
      background: #212324;
      border-radius: 16px;
      max-width: 700px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      padding: 32px 28px 28px 28px;
      animation: modalSlideIn 0.3s ease;
    }
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 32px;
      height: 32px;
      border: none;
      background: #2a2d2f;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      color: #B6BABF;
      font-size: 20px;
      z-index: 10;
    }
    .close-btn:hover {
      background: #72E4A0;
      color: #181A1B;
    }
    .doc-title {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #F3F6F8;
    }
    .doc-desc {
      font-size: 15px;
      color: #B6BABF;
      line-height: 1.6;
      margin-bottom: 24px;
    }
    .doc-fields-row {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      align-items: flex-start;
    }
    .doc-field-title {
      min-width: 110px;
      color: #74cba4;
      font-size: 14px;
      font-weight: 500;
    }
    .doc-tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      flex: 1;
    }
    .doc-tag {
      background: rgba(114, 228, 160, 0.15);
      color: #72E4A0;
      font-size: 13px;
      border-radius: 8px;
      padding: 4px 12px;
    }
    .doc-actions {
      margin: 0;
      padding: 0 0 0 18px;
      font-size: 14px;
      color: #DEE6EA;
      line-height: 1.6;
      flex: 1;
    }
    .doc-actions li {
      margin-bottom: 4px;
    }
    .doc-content {
      font-size: 14px;
      color: #DEE6EA;
      background: #2a2d2f;
      padding: 12px 14px;
      border-radius: 8px;
      line-height: 1.6;
      flex: 1;
    }
    .doc-actions-buttons {
      margin-top: 24px;
      display: flex;
      gap: 12px;
    }
    .download-btn, .delete-btn {
      background: #72E4A0;
      color: #181A1B;
      border: 0;
      border-radius: 8px;
      font-size: 14px;
      padding: 10px 20px;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s;
      font-family: 'Inter', sans-serif;
    }
    .delete-btn {
      background: transparent;
      color: #ff6b6b;
      border: 1.5px solid #ff6b6b;
    }
    .download-btn:hover {
      background: #4BC483;
    }
    .delete-btn:hover {
      background: rgba(255, 107, 107, 0.1);
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #B6BABF;
    }
  </style>
</head>
<body>
  <aside>
    <div class="menu-header">
      <div class="menu-logo">DocStorage</div>
      <button class="add-icon-btn" onclick="openUploadModal()">+</button>
    </div>
    <div class="menu-section">
      <div class="menu-title">Категории</div>
      <div class="menu-item active" onclick="filterDocuments()">Все документы</div>
      <div id="categoriesList"></div>
    </div>
    <div class="menu-section">
      <div class="menu-title">Теги</div>
      <div id="tagsList"></div>
    </div>
  </aside>

  <main>
    <div class="main-header">
      <h1 class="main-title">Все документы</h1>
      <p class="main-subtitle">Кликните на карточку для просмотра деталей</p>
    </div>
    <div class="preview-grid" id="previewGrid">
      <div class="loading">Загрузка документов...</div>
    </div>
  </main>

  <div class="upload-modal" id="uploadModal">
    <div class="upload-form">
      <h2>Загрузить документ</h2>
      <form id="uploadForm">
        <div class="form-group">
          <label>Файл *</label>
          <div class="file-input-wrapper">
            <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png" required>
            <div class="file-input-label">Выберите файл (PDF, JPEG, PNG)</div>
            <div class="selected-file" id="selectedFile"></div>
          </div>
        </div>
        
        <div class="form-group">
          <label>Название *</label>
          <input type="text" id="titleInput" placeholder="Название документа" required>
        </div>
        
        <div class="form-group">
          <label>Описание</label>
          <textarea id="descInput" placeholder="Краткое описание документа"></textarea>
        </div>

        <div class="form-group">
          <label>Категории</label>
          <div class="tag-input-wrapper" id="categoriesWrapper"></div>
          <div class="help-text">Введите категорию и нажмите Enter (например: финансы, медицина)</div>
        </div>

        <div class="form-group">
          <label>Теги</label>
          <div class="tag-input-wrapper" id="tagsWrapper"></div>
          <div class="help-text">Введите тег и нажмите Enter (например: важное, срочно, 2025)</div>
        </div>

        <div class="form-group">
          <label>Действия (что нужно сделать)</label>
          <textarea id="actionsInput" placeholder="Каждое действие с новой строки, например:&#10;Оплатить до 1 ноября&#10;Согласовать с бухгалтерией&#10;Отправить копию"></textarea>
        </div>

        <div class="form-group">
          <label>Содержание</label>
          <textarea id="contentInput" placeholder="Основное содержание документа или важные выдержки" style="min-height: 120px;"></textarea>
        </div>

        <div class="form-buttons">
          <button type="button" class="btn btn-secondary" onclick="closeUploadModal()">Отмена</button>
          <button type="submit" class="btn btn-primary" id="uploadBtn">Загрузить</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal-overlay" id="modalOverlay" onclick="closeModalOnOverlay(event)">
    <div class="modal-card" onclick="event.stopPropagation()">
      <button class="close-btn" onclick="closeModal()">×</button>
      <div id="modalContent"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    var SUPABASE_URL = 'https://zudvtnxzwnyxxtgmlenf.supabase.co';
    var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZHZ0bnh6d255eHh0Z21sZW5mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5MTIzNTAsImV4cCI6MjA3NjQ4ODM1MH0.ZJGsAv6H-rm6NzUrT_jWITvwZbrRDsxLcDSNOIfQzgk';
    var supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    var allDocuments = [];
    var currentDocument = null;
    var categories = [];
    var tags = [];

    function createTagInput(wrapperId, arrayName) {
      var wrapper = document.getElementById(wrapperId);
      var input = document.createElement('input');
      input.type = 'text';
      input.className = 'tag-input';
      input.placeholder = 'Введите и нажмите Enter';
      
      input.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          var value = input.value.trim();
          if (value) {
            if (arrayName === 'categories') {
              if (categories.indexOf(value) === -1) {
                categories.push(value);
                renderTags(wrapperId, categories, 'categories');
              }
            } else {
              if (tags.indexOf(value) === -1) {
                tags.push(value);
                renderTags(wrapperId, tags, 'tags');
              }
            }
            input.value = '';
          }
        }
      });
      
      wrapper.appendChild(input);
    }

    function renderTags(wrapperId, array, arrayName) {
      var wrapper = document.getElementById(wrapperId);
      var input = wrapper.querySelector('.tag-input');
      
      var existingTags = wrapper.querySelectorAll('.tag-item');
      for (var i = 0; i < existingTags.length; i++) {
        existingTags[i].remove();
      }
      
      for (var i = 0; i < array.length; i++) {
        var tagItem = document.createElement('div');
        tagItem.className = 'tag-item';
        tagItem.innerHTML = array[i] + '<span class="tag-remove" onclick="removeTag(\'' + arrayName + '\', ' + i + ')">×</span>';
        wrapper.insertBefore(tagItem, input);
      }
    }

    function removeTag(arrayName, index) {
      if (arrayName === 'categories') {
        categories.splice(index, 1);
        renderTags('categoriesWrapper', categories, 'categories');
      } else {
        tags.splice(index, 1);
        renderTags('tagsWrapper', tags, 'tags');
      }
    }

    function loadDocuments() {
      supabase.from('documents').select('*').order('created_at', { ascending: false })
        .then(function(response) {
          if (response.error) throw response.error;
          allDocuments = response.data || [];
          renderDocuments(allDocuments);
          updateFilters();
        })
        .catch(function(error) {
          console.error('Ошибка загрузки:', error);
          document.getElementById('previewGrid').innerHTML = '<div class="loading">Ошибка загрузки</div>';
        });
    }

    function renderDocuments(documents) {
      var grid = document.getElementById('previewGrid');
      if (documents.length === 0) {
        grid.innerHTML = '<div class="loading">Нет документов. Нажмите + для добавления.</div>';
        return;
      }
      var html = '';
      for (var i = 0; i < documents.length; i++) {
        var doc = documents[i];
        var tagsHtml = '';
        if (doc.tags) {
          for (var j = 0; j < doc.tags.length; j++) {
            tagsHtml += '<span class="preview-tag">' + doc.tags[j] + '</span>';
          }
        }
        html += '<div class="preview-card" onclick="openDocumentModal(\'' + doc.id + '\')">' +
          '<div class="preview-icon">📄</div>' +
          '<div class="preview-title">' + (doc.title || 'Без названия') + '</div>' +
          '<div class="preview-desc">' + (doc.description || 'Нет описания') + '</div>' +
          '<div class="preview-tags">' + tagsHtml + '</div></div>';
      }
      grid.innerHTML = html;
    }

    function updateFilters() {
      var cats = new Set();
      var tagsSet = new Set();
      for (var i = 0; i < allDocuments.length; i++) {
        var doc = allDocuments[i];
        if (doc.categories) {
          for (var j = 0; j < doc.categories.length; j++) cats.add(doc.categories[j]);
        }
        if (doc.tags) {
          for (var j = 0; j < doc.tags.length; j++) tagsSet.add(doc.tags[j]);
        }
      }
      var catList = document.getElementById('categoriesList');
      var catHtml = '';
      cats.forEach(function(cat) {
        catHtml += '<div class="menu-item">' + cat + '</div>';
      });
      catList.innerHTML = catHtml;

      var tagsList = document.getElementById('tagsList');
      var tagsHtml = '';
      tagsSet.forEach(function(tag) {
        tagsHtml += '<div class="menu-item">' + tag + '</div>';
      });
      tagsList.innerHTML = tagsHtml;
    }

    function filterDocuments() {
      renderDocuments(allDocuments);
    }

    function openUploadModal() {
      categories = [];
      tags = [];
      document.getElementById('uploadModal').classList.add('active');
      document.getElementById('categoriesWrapper').innerHTML = '';
      document.getElementById('tagsWrapper').innerHTML = '';
      createTagInput('categoriesWrapper', 'categories');
      createTagInput('tagsWrapper', 'tags');
    }

    function closeUploadModal() {
      document.getElementById('uploadModal').classList.remove('active');
      document.getElementById('uploadForm').reset();
      document.getElementById('selectedFile').textContent = '';
      categories = [];
      tags = [];
    }

    document.getElementById('fileInput').addEventListener('change', function(e) {
      var file = e.target.files[0];
      if (file) {
        document.getElementById('selectedFile').textContent = 'Выбран: ' + file.name;
        document.getElementById('titleInput').value = file.name.replace(/\.[^/.]+$/, "");
      }
    });

    document.getElementById('uploadForm').addEventListener('submit', function(e) {
      e.preventDefault();
      var fileInput = document.getElementById('fileInput');
      var file = fileInput.files[0];
      var title = document.getElementById('titleInput').value;
      var description = document.getElementById('descInput').value;
      var actionsText = document.getElementById('actionsInput').value;
      var content = document.getElementById('contentInput').value;
      
      var actions = [];
      if (actionsText) {
        var lines = actionsText.split('\n');
        for (var i = 0; i < lines.length; i++) {
          var line = lines[i].trim();
          if (line) actions.push(line);
        }
      }
      
      if (!file) return;

      var uploadBtn = document.getElementById('uploadBtn');
      uploadBtn.disabled = true;
      uploadBtn.textContent = 'Загрузка...';

      var fileName = Date.now() + '_' + file.name;
      supabase.storage.from('documents').upload(fileName, file)
        .then(function(uploadResponse) {
          if (uploadResponse.error) throw uploadResponse.error;
          var urlData = supabase.storage.from('documents').getPublicUrl(fileName);
          return supabase.from('documents').insert([{
            filename: file.name,
            file_url: urlData.data.publicUrl,
            title: title,
            description: description,
            categories: categories,
            tags: tags,
            actions: actions,
            content: content,
            lang: 'ru',
            ai_filled: false
          }]).select();
        })
        .then(function(docResponse) {
          if (docResponse.error) throw docResponse.error;
          alert('Документ загружен!');
          closeUploadModal();
          loadDocuments();
        })
        .catch(function(error) {
          console.error('Ошибка:', error);
          alert('Ошибка: ' + error.message);
        })
        .finally(function() {
          uploadBtn.disabled = false;
          uploadBtn.textContent = 'Загрузить';
        });
    });

    function openDocumentModal(docId) {
      var doc = null;
      for (var i = 0; i < allDocuments.length; i++) {
        if (allDocuments[i].id === docId) {
          doc = allDocuments[i];
          break;
        }
      }
      if (!doc) return;
      currentDocument = doc;

      var content = '<div class="doc-title">' + (doc.title || 'Без названия') + '</div>' +
        '<div class="doc-desc">' + (doc.description || 'Нет описания') + '</div>';

      if (doc.categories && doc.categories.length > 0) {
        var catsHtml = '';
        for (var i = 0; i < doc.categories.length; i++) {
          catsHtml += '<span class="doc-tag">' + doc.categories[i] + '</span>';
        }
        content += '<div class="doc-fields-row"><div class="doc-field-title">Категории:</div><div class="doc-tags">' + catsHtml + '</div></div>';
      }

      if (doc.tags && doc.tags.length > 0) {
        var tagsHtml = '';
        for (var i = 0; i < doc.tags.length; i++) {
          tagsHtml += '<span class="doc-tag">' + doc.tags[i] + '</span>';
        }
        content += '<div class="doc-fields-row"><div class="doc-field-title">Теги:</div><div class="doc-tags">' + tagsHtml + '</div></div>';
      }

      if (doc.actions && doc.actions.length > 0) {
        var actionsHtml = '<ul class="doc-actions">';
        for (var i = 0; i < doc.actions.length; i++) {
          actionsHtml += '<li>' + doc.actions[i] + '</li>';
        }
        actionsHtml += '</ul>';
        content += '<div class="doc-fields-row"><div class="doc-field-title">Что сделать:</div>' + actionsHtml + '</div>';
      }

      if (doc.content) {
        content += '<div class="doc-fields-row"><div class="doc-field-title">Содержание:</div><div class="doc-content">' + doc.content + '</div></div>';
      }

      content += '<div class="doc-actions-buttons">' +
        '<a class="download-btn" href="' + doc.file_url + '" download="' + doc.filename + '" target="_blank">Скачать</a>' +
        '<button class="delete-btn" onclick="deleteDocument(\'' + doc.id + '\')">Удалить</button>' +
        '</div>';

      document.getElementById('modalContent').innerHTML = content;
      document.getElementById('modalOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function deleteDocument(docId) {
      if (!confirm('Удалить документ?')) return;
      var doc = null;
      for (var i = 0; i < allDocuments.length; i++) {
        if (allDocuments[i].id === docId) {
          doc = allDocuments[i];
          break;
        }
      }
      if (!doc) return;

      var fileName = doc.file_url.split('/').pop();
      supabase.storage.from('documents').remove([fileName])
        .then(function() {
          return supabase.from('documents').delete().eq('id', docId);
        })
        .then(function(response) {
          if (response.error) throw response.error;
          alert('Документ удален');
          closeModal();
          loadDocuments();
        })
        .catch(function(error) {
          console.error('Ошибка:', error);
          alert('Ошибка: ' + error.message);
        });
    }

    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('active');
      document.body.style.overflow = 'auto';
      currentDocument = null;
    }

    function closeModalOnOverlay(event) {
      if (event.target.id === 'modalOverlay') {
        closeModal();
      }
    }

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
        closeUploadModal();
      }
    });

    loadDocuments();
  </script>
</body>
</html>
